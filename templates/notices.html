{% extends "base.html" %}
{% block content %}
<h1 class="text-3xl font-bold mb-6">Notices & Notifications</h1>

{% if current_user.role == 'admin' %}
<div class="bg-white p-6 rounded-lg shadow-sm mb-8 border border-gray-100">
    <h2 class="text-xl font-bold mb-4 text-gray-800">Issue New Notice</h2>
    <form method="POST" class="space-y-4">
        <input type="hidden" name="action" value="send">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-1">
                <label class="block text-sm font-semibold text-gray-600 mb-1">Send To</label>
                <select name="target" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none" required>
                    <option value="all">All Members</option>
                    {% for u in users %}
                        {% if u.username != current_user.username %}
                        <option value="{{ u.username }}">{{ u.username }} (Member)</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div class="md:col-span-1">
                <label class="block text-sm font-semibold text-gray-600 mb-1">Notice Title</label>
                <input type="text" name="title" placeholder="Important Update" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none" required>
            </div>
        </div>
        <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Message</label>
            <textarea name="message" placeholder="Type notice content here..." class="w-full border p-2 rounded h-32 focus:ring-2 focus:ring-blue-500 outline-none" required></textarea>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-8 py-2 rounded hover:bg-blue-700 font-bold shadow-sm">Issue Notice</button>
    </form>
</div>
{% endif %}

<div class="space-y-4">
    <h3 class="text-lg font-bold text-gray-700 mb-4">Notice History</h3>
    {% for notice in notices|reverse %}
    <div class="bg-white p-5 rounded-lg shadow-sm border-l-4 {% if notice.target == 'all' %}border-blue-500{% else %}border-purple-500{% endif %}">
        <div class="flex justify-between items-start mb-2">
            <h4 class="font-bold text-xl text-gray-800">{{ notice.title }}</h4>
            <span class="text-xs text-gray-400">{{ notice.date }}</span>
        </div>
        <div class="flex items-center space-x-2 mb-3">
            <span class="text-xs font-bold px-2 py-0.5 rounded-full {% if notice.target == 'all' %}bg-blue-50 text-blue-600{% else %}bg-purple-50 text-purple-600{% endif %}">
                To: {{ 'Everyone' if notice.target == 'all' else notice.target }}
            </span>
            <span class="text-xs text-gray-500">From: Admin</span>
        </div>
        <p class="text-gray-700 leading-relaxed whitespace-pre-wrap">{{ notice.message }}</p>
    </div>
    {% else %}
    <p class="bg-white p-8 text-center text-gray-500 rounded-lg shadow-sm border border-dashed border-gray-300">No notices found.</p>
    {% endfor %}
</div>
{% endblock %}
